<!DOCTYPE html>
<html lang="id">
<head>
    <title>Setup Data Awal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-5 text-center">

    <h1>Setup Data Awal</h1>
    <p>Klik tombol di bawah untuk membuat akun contoh.</p>
    
    <div class="d-grid gap-3 col-6 mx-auto mt-4">
        <button id="btnGuru" class="btn btn-danger btn-lg">1. Buat Akun GURU</button>
        <button id="btnSiswa" class="btn btn-success btn-lg">2. Buat Akun SISWA</button>
    </div>

    <div id="status" class="mt-4 alert alert-info" role="alert">
        Status: Menunggu perintah...
    </div>

    <script type="module">
        // Import fungsi dari Firebase
        import { auth, db } from "./js/firebase-config.js";
        import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const statusBox = document.getElementById("status");

        // --- FUNGSI MEMBUAT AKUN GURU ---
        document.getElementById("btnGuru").addEventListener("click", async () => {
            try {
                statusBox.innerText = "Sedang membuat akun Guru...";
                
                // 1. Buat Login Auth
                const email = "guru@sekolah.id";
                const pass = "guru123"; // Password sementara
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;

                // 2. Simpan Data Profil ke Database
                await setDoc(doc(db, "users", user.uid), {
                    nama: "Bapak Guru Budi",
                    email: email,
                    role: "guru",     // <--- INI KUNCINYA
                    nip: "19800101"
                });

                statusBox.className = "alert alert-success mt-4";
                statusBox.innerText = `SUKSES! Akun Guru dibuat.\nEmail: ${email}\nPass: ${pass}`;

            } catch (error) {
                statusBox.className = "alert alert-danger mt-4";
                statusBox.innerText = "Error: " + error.message;
                console.error(error);
            }
        });

        // --- FUNGSI MEMBUAT AKUN SISWA ---
        document.getElementById("btnSiswa").addEventListener("click", async () => {
            try {
                statusBox.innerText = "Sedang membuat akun Siswa...";
                
                // 1. Buat Login Auth
                const email = "siswa@sekolah.id";
                const pass = "siswa123";
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;

                // 2. Simpan Data Profil ke Database
                await setDoc(doc(db, "users", user.uid), {
                    nama: "Andi Siswa",
                    email: email,
                    role: "siswa",    // <--- INI KUNCINYA
                    nis: "2024001",
                    kelas: "X-IPA-1"
                });

                statusBox.className = "alert alert-success mt-4";
                statusBox.innerText = `SUKSES! Akun Siswa dibuat.\nEmail: ${email}\nPass: ${pass}`;

            } catch (error) {
                statusBox.className = "alert alert-danger mt-4";
                statusBox.innerText = "Error: " + error.message;
                console.error(error);
            }
        });
    </script>
</body>
</html>